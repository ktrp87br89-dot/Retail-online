<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Promo Catalog - Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --surface: #ffffff;
            --background: #f8fafc;
            --text-dark: #0f172a;
            --text-gray: #64748b;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --radius-lg: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-sticky: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Prompt', sans-serif; }
        body { background-color: var(--background); color: var(--text-dark); line-height: 1.5; padding-bottom: 100px;}
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px;}

        /* Sticky Header */
        .sticky-wrapper { position: sticky; top: 0; z-index: 1000; background: rgba(248, 250, 252, 0.95); backdrop-filter: blur(10px); padding: 20px 0 15px 0; border-bottom: 1px solid #e2e8f0; margin-bottom: 30px; box-shadow: var(--shadow-sticky);}
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .header h1 { font-size: 26px; font-weight: 700; color: var(--text-dark); letter-spacing: -0.5px; display: flex; align-items: center; gap: 10px;}
        .btn-help { background: #e0e7ff; color: var(--primary); border: none; padding: 6px 12px; border-radius: 50px; font-size: 13px; font-weight: 700; cursor: pointer; transition: 0.2s;}
        .btn-help:hover { background: #c7d2fe; }

        .controls { display: flex; gap: 10px; width: 100%; max-width: 700px; flex-wrap: wrap;}
        .search-box { flex: 1; min-width: 250px; padding: 12px 20px; border: 1px solid #cbd5e1; border-radius: 50px; font-size: 15px; transition: all 0.3s ease; }
        .search-box:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15); }
        .sort-select { padding: 12px 20px; border: 1px solid #cbd5e1; border-radius: 50px; font-size: 14px; outline: none; cursor: pointer; color: var(--text-dark); background: white;}
        .btn-primary { background-color: var(--primary); color: white; padding: 12px 24px; border: none; border-radius: 50px; font-size: 15px; font-weight: 600; cursor: pointer; transition: 0.2s; white-space: nowrap;}
        
        .filters { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .filters::-webkit-scrollbar { display: none; }
        .filter-btn { background: var(--surface); border: 1px solid #cbd5e1; padding: 8px 20px; border-radius: 50px; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text-gray); transition: 0.2s; white-space: nowrap; }
        .filter-btn.active { background: var(--text-dark); color: white; border-color: var(--text-dark); }
        
        /* Product Cards */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; }
        .product-card { background: var(--surface); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow); transition: 0.3s; border: 1px solid #f1f5f9; display: flex; flex-direction: column;}
        .product-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-hover); }
        .card-img-wrapper { height: 200px; background: #f1f5f9; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; cursor: pointer;}
        .card-img-wrapper::after { content: 'üîç ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û'; position: absolute; bottom: -50px; left: 0; width: 100%; background: rgba(15, 23, 42, 0.85); color: white; text-align: center; padding: 10px 0; font-size: 13px; font-weight: 600; transition: 0.3s ease-in-out; }
        .card-img-wrapper:hover::after { bottom: 0; }
        .img-placeholder { color: #94a3b8; font-size: 14px; font-weight: 600; }
        
        .card-content { padding: 20px; display: flex; flex-direction: column; flex-grow: 1;}
        .brand-badge { display: inline-block; align-self: flex-start; padding: 4px 10px; background-color: #e0e7ff; color: var(--primary); border-radius: 6px; font-size: 12px; font-weight: 700; margin-bottom: 12px; }
        .product-title { font-size: 17px; font-weight: 700; margin-bottom: 10px; color: var(--text-dark); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4;}
        .benefit-tag { font-size: 13px; color: #059669; background: #d1fae5; padding: 4px 8px; border-radius: 6px; display: inline-block; margin-bottom: 15px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;}
        .price-container { display: flex; align-items: flex-end; justify-content: space-between; padding-top: 15px; border-top: 1px solid #f1f5f9; margin-bottom: 15px;}
        .normal-price { text-decoration: line-through; color: #94a3b8; font-size: 13px; display: block; margin-bottom: 2px;}
        .special-price { font-size: 24px; font-weight: 700; color: var(--danger); line-height: 1;}

        /* User & Admin Controls */
        .user-controls { display: flex; gap: 8px; }
        .btn-cart-add { flex: 1; padding: 10px; border: none; background: #fef08a; border-radius: 8px; font-size: 14px; font-weight: 700; color: #854d0e; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px;}
        .btn-cart-add:hover { background: #fde047; }
        
        .admin-controls { display: flex; gap: 8px; margin-top: 8px;}
        .btn-action { flex: 1; padding: 8px; border: 1px solid #e2e8f0; background: #f8fafc; border-radius: 8px; font-size: 13px; font-weight: 600; color: var(--text-dark); cursor: pointer; }
        .btn-danger { color: var(--danger); border-color: #fecaca; background: #fef2f2; flex: 0.3; }

        /* Skeleton Load */
        .skeleton-card { background: white; border-radius: var(--radius-lg); border: 1px solid #f1f5f9; overflow: hidden; height: 400px;}
        .skeleton-img { height: 200px; width: 100%; }
        .skeleton-text { height: 20px; margin: 20px; border-radius: 4px; }
        .skeleton-anim { background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* Floating Cart Button */
        .floating-cart-btn { position: fixed; bottom: 30px; left: 30px; background: var(--warning); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4); border: none; cursor: pointer; z-index: 1000; transition: 0.3s;}
        .floating-cart-btn:hover { transform: scale(1.1); }
        .cart-badge { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; font-size: 12px; font-weight: 700; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid white;}

        /* Modals (View, Form, Cart, Promo) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.7); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; pointer-events: none; transition: 0.3s; padding: 20px; backdrop-filter: blur(4px);}
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content { background: white; width: 100%; max-width: 550px; border-radius: var(--radius-lg); padding: 30px; box-shadow: var(--shadow-hover); transform: translateY(20px); transition: 0.3s; max-height: 90vh; overflow-y: auto; position: relative;}
        .modal-overlay.active .modal-content { transform: translateY(0); }
        
        .modal-close { position: absolute; top: 15px; right: 15px; background: #f1f5f9; border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 16px; cursor: pointer; transition: 0.2s; color: var(--text-gray); z-index: 10;}
        .modal-close:hover { background: #e2e8f0; color: var(--danger); }

        /* View Modal Specifics */
        .view-image { width: 100%; max-height: 300px; object-fit: contain; border-radius: 12px; margin-bottom: 20px; background: #f8fafc;}
        .view-title { font-size: 22px; font-weight: 700; color: var(--text-dark); margin-bottom: 15px; line-height: 1.3;}
        .view-benefits-box { background: #f0fdf4; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #bbf7d0;}
        .view-price-box { background: #fef2f2; padding: 20px; border-radius: 12px; border: 1px solid #fecaca; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;}
        
        /* Auto-Infographic Generator Mode */
        .promo-gen-container { width: 100%; aspect-ratio: 1/1; background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%); border-radius: 0; padding: 25px; display: flex; flex-direction: column; text-align: center; border: 2px solid #e2e8f0; position: relative;}
        .promo-gen-brand { font-size: 18px; font-weight: 700; color: var(--primary); letter-spacing: 2px; margin-bottom: 10px; text-transform: uppercase;}
        .promo-gen-img { width: 100%; height: 40%; object-fit: contain; margin-bottom: 15px; mix-blend-mode: multiply;}
        .promo-gen-title { font-size: 24px; font-weight: 700; color: #0f172a; line-height: 1.2; margin-bottom: 10px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;}
        .promo-gen-benefits { font-size: 16px; color: #059669; font-weight: 600; background: #d1fae5; padding: 8px 15px; border-radius: 50px; display: inline-block; margin: 0 auto 15px auto;}
        .promo-gen-price { font-size: 42px; font-weight: 700; color: var(--danger); margin-top: auto;}
        .promo-gen-hint { text-align: center; color: var(--text-gray); font-size: 14px; margin-top: 15px; font-weight: 600;}

        /* Cart Modal Specifics */
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #e2e8f0;}
        .cart-item-title { font-weight: 600; font-size: 15px; color: var(--text-dark);}
        .cart-item-price { color: var(--danger); font-weight: 700;}
        .btn-cart-remove { background: #fee2e2; color: var(--danger); border: none; width: 30px; height: 30px; border-radius: 6px; cursor: pointer; font-weight: bold;}
        .cart-total { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; font-size: 20px; font-weight: 700; color: var(--text-dark);}

        /* Buttons */
        .btn-copy-line { width: 100%; background: #00B900; color: white; border: none; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;}
        .btn-promo-gen { width: 100%; background: #6366f1; color: white; border: none; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: 0.2s; margin-top: 10px;}

        /* Forms */
        .form-group { margin-bottom: 15px;}
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text-gray); margin-bottom: 5px; }
        .form-control { width: 100%; padding: 10px 15px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; outline: none; font-family: 'Prompt';}

        /* Tour Overlay */
        .tour-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 4000; display: none; align-items: center; justify-content: center; flex-direction: column; text-align: center; padding: 20px;}
        .tour-box { background: white; padding: 30px; border-radius: 16px; max-width: 400px;}
        .tour-title { font-size: 22px; font-weight: 700; color: var(--primary); margin-bottom: 15px;}
        .tour-desc { font-size: 16px; margin-bottom: 25px; line-height: 1.5;}

        /* Admin & Toast */
        .mode-toggle { position: fixed; bottom: 30px; right: 30px; background: white; padding: 12px 20px; border-radius: 50px; box-shadow: var(--shadow-hover); display: flex; align-items: center; gap: 12px; z-index: 1000; border: 1px solid #e2e8f0;}
        .toggle-switch { position: relative; width: 40px; height: 22px; background: #cbd5e1; border-radius: 24px; cursor: pointer; }
        .toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: 0.3s;}
        .toggle-switch.active { background: var(--primary); }
        .toggle-switch.active::after { left: 20px; }
        .toast-container { position: fixed; top: 20px; right: 20px; background: #1e293b; color: white; padding: 14px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; box-shadow: 0 10px 15px rgba(0,0,0,0.2); opacity: 0; transform: translateX(50px); transition: 0.4s; z-index: 5000;}
        .toast-container.show { opacity: 1; transform: translateX(0); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="sticky-wrapper">
        <div class="container">
            <div class="header">
                <h1>üì¶ PROMO CENTER <button class="btn-help" onclick="startTour()">‚ùì ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button></h1>
                <div class="controls">
                    <input type="text" id="searchInput" class="search-box" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏ä‡∏∑‡πà‡∏≠, ‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå, ‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì...">
                    <select id="sortSelect" class="sort-select">
                        <option value="default">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°: ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</option>
                        <option value="price_asc">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ï‡πà‡∏≥ ‚û°Ô∏è ‡∏™‡∏π‡∏á</option>
                        <option value="price_desc">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏™‡∏π‡∏á ‚û°Ô∏è ‡∏ï‡πà‡∏≥</option>
                    </select>
                    <button class="btn-primary hidden" id="btnAddPromo" onclick="openFormModal('add')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</button>
                </div>
            </div>

            <div class="filters" id="filterContainer">
                <button class="filter-btn active" data-filter="all">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-btn" data-filter="HAPPY TRENDS">HAPPY TRENDS</button>
                <button class="filter-btn" data-filter="YURA">YURA</button>
                <button class="filter-btn" data-filter="BONBACK">BONBACK</button>
                <button class="filter-btn" data-filter="‡∏™‡∏∏‡∏Ç‡∏Å‡∏≤‡∏¢‡∏∞">‡∏™‡∏∏‡∏Ç‡∏Å‡∏≤‡∏¢‡∏∞</button>
                <button class="filter-btn" data-filter="FLi">FLi</button>
                <button class="filter-btn" data-filter="‡πÄ‡∏ö‡∏ç‡∏à ‡∏≠‡∏≠‡∏¢‡∏•‡πå">‡πÄ‡∏ö‡∏ç‡∏à ‡∏≠‡∏≠‡∏¢‡∏•‡πå</button>
                <button class="filter-btn" data-filter="‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÇ‡∏≠‡∏™‡∏ñ">‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÇ‡∏≠‡∏™‡∏ñ</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="product-grid" id="productGrid">
            <div class="skeleton-card"><div class="skeleton-img skeleton-anim"></div><div class="skeleton-text skeleton-anim"></div></div>
            <div class="skeleton-card"><div class="skeleton-img skeleton-anim"></div><div class="skeleton-text skeleton-anim"></div></div>
        </div>
    </div>

    <button class="floating-cart-btn" onclick="openCartModal()">üõí<span class="cart-badge" id="cartBadge">0</span></button>
    <div class="mode-toggle">
        <span id="adminLabel" style="font-weight: 600; font-size: 13px;">‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
        <div class="toggle-switch" id="adminToggle"></div>
    </div>
    <div id="toastMessage" class="toast-container"></div>

    <div class="modal-overlay" id="viewModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeViewModal()">‚úñ</button>
            <div id="viewNormalContent">
                <img id="viewImage" class="view-image" src="" alt="Product">
                <span class="brand-badge" id="viewBrand"></span>
                <h2 class="view-title" id="viewTitle"></h2>
                <div id="viewBenefitsBox" class="view-benefits-box">
                    <div style="font-size:14px; font-weight:700; color:#166534;">‚ú® ‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì</div>
                    <div id="viewBenefits" style="font-size:14px; color:#064e3b;"></div>
                </div>
                <div class="view-price-box">
                    <div>
                        <span style="font-size: 13px; color: var(--danger); font-weight: 600;">üî• ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</span>
                        <span id="viewNormalPrice" style="text-decoration: line-through; color: #9ca3af; font-size: 13px; display: block;"></span>
                    </div>
                    <div id="viewSpecialPrice" style="font-size: 32px; font-weight: 700; color: var(--danger);"></div>
                </div>
                <button class="btn-copy-line" onclick="copyToLine()">üí¨ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á LINE</button>
                <button class="btn-promo-gen" onclick="generatePromoImage()">üé® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ó (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡∏õ‡∏à‡∏≠)</button>
            </div>

            <div id="viewPromoGenContent" class="hidden">
                <h3 style="text-align:center; margin-bottom:15px; color:var(--primary);">üì∏ ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</h3>
                <div class="promo-gen-container" id="promoCanvas">
                    <div class="promo-gen-brand" id="genBrand"></div>
                    <img class="promo-gen-img" id="genImage" src="">
                    <div class="promo-gen-benefits" id="genBenefits"></div>
                    <div class="promo-gen-title" id="genTitle"></div>
                    <div class="promo-gen-price" id="genPrice"></div>
                </div>
                <button class="btn-cancel" style="width:100%; margin-top:15px;" onclick="closePromoImage()">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="cartModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCartModal()">‚úñ</button>
            <h2 class="modal-title">üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠</h2>
            <div id="cartItemsContainer"></div>
            <div class="cart-total">
                <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                <span id="cartTotalPrice" style="color:var(--danger);">0.-</span>
            </div>
            <button class="btn-copy-line" onclick="copyCartToLine()">üìù ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å "‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤" ‡∏™‡πà‡∏á LINE</button>
        </div>
    </div>

    <div class="modal-overlay" id="formModal">
        <div class="modal-content">
            <h2 class="modal-title" id="formModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            <input type="hidden" id="formRowIndex">
            <div class="form-group"><label>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</label><input type="text" id="formBrand" class="form-control"></div>
            <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input type="text" id="formTitle" class="form-control"></div>
            <div class="form-group"><label>‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì</label><textarea id="formBenefits" class="form-control" rows="2"></textarea></div>
            <div class="form-group"><label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label><textarea id="formDesc" class="form-control" rows="2"></textarea></div>
            <div style="display:flex; gap:10px;">
                <div class="form-group" style="flex:1;"><label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</label><input type="number" id="formNormal" class="form-control"></div>
                <div class="form-group" style="flex:1;"><label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©</label><input type="number" id="formSpecial" class="form-control"></div>
            </div>
            <div class="form-group"><label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label><input type="text" id="formImage" class="form-control"></div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeFormModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn-save" id="btnSave" onclick="saveData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div class="tour-overlay" id="tourOverlay">
        <div class="tour-box">
            <div class="tour-title" id="tourTitle">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏ã‡∏•‡∏™‡πå‡πÉ‡∏´‡∏°‡πà! üëã</div>
            <div class="tour-desc" id="tourDesc">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏Ñ‡∏ï‡∏ï‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏π‡πà‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô</div>
            <button class="btn-primary" style="width:100%;" id="btnTourNext" onclick="nextTour()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏£‡∏∞‡∏ö‡∏ö üöÄ</button>
        </div>
    </div>

    <script>
        // ‡∏Ñ‡∏á URL ‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏±‡∏á
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzfhzBH0dzt1lxObKp6q0Fu6kb3c55UbZaWAI7AuzM712ndg-ExrvMSLv8xiOYxbkq9/exec'; 
        
        let allProducts = [];
        let currentAdminLevel = 0; 
        let currentAction = 'add'; 
        let cart = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toastMessage');
            toast.innerHTML = type === 'success' ? `‚úÖ ${message}` : `‚ö†Ô∏è ${message}`;
            toast.className = `toast-container show toast-${type}`;
            toast.style.borderLeft = type === 'success' ? '4px solid var(--success)' : '4px solid var(--danger)';
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        function getDirectImageUrl(url) {
            if (!url || url === '‡∏£‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î' || url.trim() === '') return null;
            if (url.includes('drive.google.com')) {
                const match = url.match(/\/d\/(.+?)\//) || url.match(/id=(.+?)(&|$)/);
                if (match && match[1]) return `https://drive.google.com/uc?export=view&id=${match[1]}`;
            }
            return url; 
        }

        async function fetchProducts() {
            try {
                const response = await fetch(APPS_SCRIPT_URL);
                allProducts = await response.json();
                applyFiltersAndRender(); 
            } catch (error) {
                document.getElementById('productGrid').innerHTML = '<div style="text-align:center; grid-column:1/-1;">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</div>';
            }
        }

        function applyFiltersAndRender() {
            const searchText = document.getElementById('searchInput').value.toLowerCase().trim();
            const filterValue = document.querySelector('.filter-btn.active').getAttribute('data-filter').toLowerCase();
            const sortType = document.getElementById('sortSelect').value;

            let filtered = [...allProducts];

            if (searchText) {
                const searchTerms = searchText.split(/\s+/);
                filtered = filtered.filter(p => {
                    const combined = `${p.Brand||''} ${p.Title||''} ${p.Benefits||''}`.toLowerCase();
                    return searchTerms.every(term => combined.includes(term));
                });
            }

            if (filterValue !== 'all') {
                filtered = filtered.filter(p => (p.Brand||'').toLowerCase().trim() === filterValue);
            }

            if (sortType === 'price_asc') filtered.sort((a, b) => (Number(a.SpecialPrice)||0) - (Number(b.SpecialPrice)||0));
            else if (sortType === 'price_desc') filtered.sort((a, b) => (Number(b.SpecialPrice)||0) - (Number(a.SpecialPrice)||0));

            renderProducts(filtered);
        }

        function renderProducts(products) {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = ''; 
            if(products.length === 0) {
                grid.innerHTML = '<div style="text-align:center; grid-column:1/-1;">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
                return;
            }

            products.forEach(product => {
                const img = getDirectImageUrl(product.ImageURL) ? `<img src="${getDirectImageUrl(product.ImageURL)}" style="width:100%;height:100%;object-fit:cover;">` : `<span class="img-placeholder">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>`;
                const benefit = product.Benefits ? `<div class="benefit-tag">‚ú® ${product.Benefits}</div>` : '';
                const adminClass = currentAdminLevel > 0 ? '' : 'hidden'; 
                const delBtn = currentAdminLevel === 2 ? `<button class="btn-action btn-danger" onclick="deleteData(${product._rowIndex})">üóëÔ∏è</button>` : ''; 

                grid.innerHTML += `
                    <div class="product-card">
                        <div class="card-img-wrapper" onclick="openViewModal(${product._rowIndex})">${img}</div>
                        <div class="card-content">
                            <span class="brand-badge">${product.Brand}</span>
                            <h2 class="product-title">${product.Title}</h2>
                            ${benefit}
                            <div class="price-container">
                                <span class="special-price">${product.SpecialPrice}.-</span>
                            </div>
                            <div class="admin-controls ${adminClass}">
                                <button class="btn-action" onclick="openFormModal('edit', ${product._rowIndex})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                ${delBtn}
                            </div>
                            <div class="user-controls" style="margin-top:10px;">
                                <button class="btn-cart-add" onclick="addToCart(${product._rowIndex})">üõí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // ==========================================
        // ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå 1: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤
        // ==========================================
        function addToCart(rowIndex) {
            const product = allProducts.find(p => p._rowIndex === rowIndex);
            cart.push(product);
            document.getElementById('cartBadge').innerText = cart.length;
            showToast(`‡πÄ‡∏û‡∏¥‡πà‡∏° "${product.Title}" ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß`);
            // ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
            const btn = document.querySelector('.floating-cart-btn');
            btn.style.transform = 'scale(1.2)';
            setTimeout(() => btn.style.transform = 'scale(1)', 200);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            document.getElementById('cartBadge').innerText = cart.length;
            renderCartItems();
        }

        function openCartModal() {
            renderCartItems();
            document.getElementById('cartModal').classList.add('active');
        }
        function closeCartModal() { document.getElementById('cartModal').classList.remove('active'); }

        function renderCartItems() {
            const container = document.getElementById('cartItemsContainer');
            let total = 0;
            container.innerHTML = '';
            
            if(cart.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-gray);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï</div>';
            } else {
                cart.forEach((item, index) => {
                    total += Number(item.SpecialPrice) || 0;
                    container.innerHTML += `
                        <div class="cart-item">
                            <div>
                                <div class="cart-item-title">${item.Title}</div>
                                <div class="cart-item-price">${item.SpecialPrice}.-</div>
                            </div>
                            <button class="btn-cart-remove" onclick="removeFromCart(${index})">‚úñ</button>
                        </div>
                    `;
                });
            }
            document.getElementById('cartTotalPrice').innerText = `${total.toLocaleString()}.-`;
        }

        function copyCartToLine() {
            if(cart.length === 0) return showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å', 'error');
            
            let text = `üìù *‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©*\n\n`;
            let total = 0;
            cart.forEach((item, i) => {
                text += `${i+1}. ${item.Title} = ${item.SpecialPrice} ‡∏ö‡∏≤‡∏ó\n`;
                total += Number(item.SpecialPrice) || 0;
            });
            text += `\nüí∞ *‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó*\n‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ! ‡∏™‡∏ô‡πÉ‡∏à‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏£‡∏±‡∏ö" ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`;

            navigator.clipboard.writeText(text).then(() => {
                showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                closeCartModal();
            });
        }

        // ==========================================
        // ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (Promo Gen)
        // ==========================================
        let currentViewProduct = null;
        
        function openViewModal(rowIndex) {
            const product = allProducts.find(p => p._rowIndex === rowIndex);
            currentViewProduct = product;
            
            // ‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
            document.getElementById('viewNormalContent').classList.remove('hidden');
            document.getElementById('viewPromoGenContent').classList.add('hidden');

            document.getElementById('viewImage').src = getDirectImageUrl(product.ImageURL) || '';
            document.getElementById('viewBrand').innerText = product.Brand;
            document.getElementById('viewTitle').innerText = product.Title;
            document.getElementById('viewNormalPrice').innerText = product.NormalPrice ? `‡∏õ‡∏Å‡∏ï‡∏¥ ${product.NormalPrice}.-` : '';
            document.getElementById('viewSpecialPrice').innerText = `${product.SpecialPrice}.-`;
            
            const benefits = document.getElementById('viewBenefitsBox');
            if(product.Benefits) {
                document.getElementById('viewBenefits').innerText = product.Benefits;
                benefits.style.display = 'block';
            } else benefits.style.display = 'none';

            document.getElementById('viewModal').classList.add('active');
        }

        function copyToLine() {
            let p = currentViewProduct;
            let text = `üî• ‡πÇ‡∏õ‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å ${p.Brand}\nüì¶ ${p.Title}\n`;
            if(p.Benefits) text += `‚ú® ‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì: ${p.Benefits}\n`;
            text += `\nüí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á: ${p.SpecialPrice} ‡∏ö‡∏≤‡∏ó (‡∏õ‡∏Å‡∏ï‡∏¥ ${p.NormalPrice||'-'})\n\n‡∏™‡∏ô‡πÉ‡∏à‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏£‡∏±‡∏ö" ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`;
            navigator.clipboard.writeText(text).then(() => {
                showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                closeViewModal();
            });
        }

        function generatePromoImage() {
            // ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î "‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡∏õ"
            document.getElementById('viewNormalContent').classList.add('hidden');
            document.getElementById('viewPromoGenContent').classList.remove('hidden');
            
            let p = currentViewProduct;
            document.getElementById('genBrand').innerText = p.Brand;
            document.getElementById('genImage').src = getDirectImageUrl(p.ImageURL) || '';
            document.getElementById('genTitle').innerText = p.Title;
            document.getElementById('genPrice').innerText = `${p.SpecialPrice}.-`;
            
            const b = document.getElementById('genBenefits');
            if(p.Benefits) { b.innerText = `‚ú® ${p.Benefits}`; b.style.display = 'inline-block'; }
            else { b.style.display = 'none'; }
        }

        function closePromoImage() {
            document.getElementById('viewPromoGenContent').classList.add('hidden');
            document.getElementById('viewNormalContent').classList.remove('hidden');
        }
        function closeViewModal() { document.getElementById('viewModal').classList.remove('active'); }

        // ==========================================
        // ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå 3: ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Onboarding Tour)
        // ==========================================
        let tourStep = 0;
        const tourData = [
            { t: "1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ üîç", d: "‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô '‡∏á‡∏≤‡∏î‡∏≥ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏Ç‡πà‡∏≤' ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏´‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ" },
            { t: "2. ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ üè∑Ô∏è", d: "‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡πà‡∏≥‡πÑ‡∏õ‡∏™‡∏π‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏á‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ" },
            { t: "3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ üõí", d: "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï' ‡∏ó‡∏µ‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏ä‡∏¥‡πâ‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" },
            { t: "4. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏™‡πà‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ üì∏", d: "‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏à‡∏∞‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ó' ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏Ñ‡πà‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏™‡πà‡∏á LINE ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!" }
        ];

        function startTour() {
            tourStep = 0;
            document.getElementById('tourOverlay').style.display = 'flex';
            updateTour();
        }

        function updateTour() {
            document.getElementById('tourTitle').innerText = tourData[tourStep].t;
            document.getElementById('tourDesc').innerText = tourData[tourStep].d;
            document.getElementById('btnTourNext').innerText = tourStep === tourData.length - 1 ? "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢! üéâ" : "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°Ô∏è";
        }

        function nextTour() {
            if(tourStep < tourData.length - 1) {
                tourStep++;
                updateTour();
            } else {
                document.getElementById('tourOverlay').style.display = 'none';
                showToast('‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏¢‡∏≠‡∏î‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!');
            }
        }

        // ==========================================
        // ‡∏£‡∏∞‡∏ö‡∏ö Backend ‡πÄ‡∏î‡∏¥‡∏° (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ input id)
        // ==========================================
        function openFormModal(action, rowIndex = null) {
            currentAction = action;
            document.getElementById('formModal').classList.add('active');
            if (action === 'add') {
                document.getElementById('formModalTitle').innerText = '‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô';
                ['formRowIndex','formBrand','formTitle','formBenefits','formDesc','formNormal','formSpecial','formImage'].forEach(id => document.getElementById(id).value = '');
            } else {
                document.getElementById('formModalTitle').innerText = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô';
                const p = allProducts.find(x => x._rowIndex === rowIndex);
                if(p) {
                    document.getElementById('formRowIndex').value = p._rowIndex;
                    document.getElementById('formBrand').value = p.Brand;
                    document.getElementById('formTitle').value = p.Title;
                    document.getElementById('formBenefits').value = p.Benefits || '';
                    document.getElementById('formDesc').value = p.Description;
                    document.getElementById('formNormal').value = p.NormalPrice;
                    document.getElementById('formSpecial').value = p.SpecialPrice;
                    document.getElementById('formImage').value = p.ImageURL;
                }
            }
        }
        function closeFormModal() { document.getElementById('formModal').classList.remove('active'); }

        async function saveData() {
            const payload = {
                action: currentAction,
                data: {
                    _rowIndex: document.getElementById('formRowIndex').value,
                    Brand: document.getElementById('formBrand').value,
                    Title: document.getElementById('formTitle').value,
                    Benefits: document.getElementById('formBenefits').value,
                    Description: document.getElementById('formDesc').value,
                    NormalPrice: document.getElementById('formNormal').value,
                    SpecialPrice: document.getElementById('formSpecial').value,
                    ImageURL: document.getElementById('formImage').value
                }
            };
            document.getElementById('btnSave').innerText = '‚è≥';
            try {
                await fetch(APPS_SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
                closeFormModal();
                showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                fetchProducts(); 
            } catch (e) { showToast('Error', 'error'); }
            document.getElementById('btnSave').innerText = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
        }

        async function deleteData(rowIndex) {
            if(confirm(`‚ö†Ô∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                await fetch(APPS_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', data: { _rowIndex: rowIndex } }) });
                showToast('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); fetchProducts();
            }
        }

        document.getElementById('adminToggle').addEventListener('click', () => {
            if (currentAdminLevel === 0) {
                const pass = prompt('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin:');
                if (pass === 'admin9sing') currentAdminLevel = 2;
                else if (pass === 'admin0208') currentAdminLevel = 1;
                
                if(currentAdminLevel > 0) {
                    document.getElementById('adminToggle').classList.add('active');
                    document.getElementById('btnAddPromo').classList.remove('hidden');
                    applyFiltersAndRender();
                }
            } else {
                currentAdminLevel = 0;
                document.getElementById('adminToggle').classList.remove('active');
                document.getElementById('btnAddPromo').classList.add('hidden');
                applyFiltersAndRender();
            }
        });

        // Event Listeners
        document.getElementById('searchInput').addEventListener('keyup', applyFiltersAndRender);
        document.getElementById('sortSelect').addEventListener('change', applyFiltersAndRender);
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                applyFiltersAndRender();
            });
        });

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        fetchProducts();
    </script>
</body>
</html>
