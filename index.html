<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Promo Catalog</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --surface: #ffffff;
            --background: #f3f4f6;
            --text-dark: #111827;
            --text-gray: #6b7280;
            --danger: #ef4444;
            --success: #10b981;
            --radius-lg: 16px;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Prompt', sans-serif; }
        body { background-color: var(--background); color: var(--text-dark); padding: 40px 20px; line-height: 1.5; }
        .container { max-width: 1200px; margin: 0 auto; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 20px; }
        .header h1 { font-size: 28px; font-weight: 700; color: var(--text-dark); letter-spacing: -0.5px; }
        .controls { display: flex; gap: 15px; width: 100%; max-width: 600px; }
        .search-box { flex: 1; padding: 14px 24px; border: 1px solid #e5e7eb; border-radius: 50px; font-size: 16px; transition: all 0.3s ease; }
        .search-box:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
        .btn-primary { background-color: var(--primary); color: white; padding: 12px 24px; border: none; border-radius: 50px; font-size: 15px; font-weight: 600; cursor: pointer; transition: 0.3s; white-space: nowrap;}
        .btn-primary:hover { background-color: var(--primary-hover); transform: translateY(-2px); }

        .filters { display: flex; gap: 10px; margin-bottom: 30px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .filter-btn { background: var(--surface); border: 1px solid #e5e7eb; padding: 8px 20px; border-radius: 50px; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text-gray); transition: 0.3s; white-space: nowrap; }
        .filter-btn.active { background: var(--text-dark); color: white; border-color: var(--text-dark); }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }
        .product-card { background: var(--surface); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(255,255,255,0.5); display: flex; flex-direction: column;}
        .product-card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); }
        
        .card-img-wrapper { height: 220px; background: #e5e7eb; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; cursor: pointer;}
        .card-img-wrapper::after { content: 'üîç ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'; position: absolute; bottom: -50px; left: 0; width: 100%; background: rgba(15, 23, 42, 0.85); color: white; text-align: center; padding: 12px 0; font-size: 14px; font-weight: 600; transition: 0.3s ease-in-out; }
        .card-img-wrapper:hover::after { bottom: 0; }
        .img-placeholder { color: #9ca3af; font-size: 14px; font-weight: 600; }
        
        .card-content { padding: 24px; display: flex; flex-direction: column; flex-grow: 1;}
        .brand-badge { display: inline-block; align-self: flex-start; padding: 4px 12px; background-color: #eef2ff; color: var(--primary); border-radius: 50px; font-size: 12px; font-weight: 700; margin-bottom: 12px; }
        .product-title { font-size: 18px; font-weight: 700; margin-bottom: 10px; color: var(--text-dark); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .product-desc { font-size: 14px; color: var(--text-gray); margin-bottom: 10px; flex-grow: 1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        /* ‡∏õ‡πâ‡∏≤‡∏¢‡∏ö‡∏≠‡∏Å‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î */
        .benefit-tag { font-size: 13px; color: #059669; background: #d1fae5; padding: 4px 8px; border-radius: 6px; display: inline-block; margin-bottom: 15px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;}

        .price-container { display: flex; align-items: flex-end; justify-content: space-between; padding-top: 16px; border-top: 1px solid #f3f4f6;}
        .normal-price { text-decoration: line-through; color: #9ca3af; font-size: 13px; display: block; margin-bottom: 2px;}
        .special-price { font-size: 26px; font-weight: 700; color: var(--danger); line-height: 1;}
        
        .admin-controls { display: flex; gap: 10px; margin-top: 20px;}
        .btn-action { flex: 1; padding: 10px; border: 1px solid #e5e7eb; background: white; border-radius: 12px; font-size: 14px; font-weight: 600; color: var(--text-dark); cursor: pointer; transition: 0.2s;}
        .btn-action:hover { background: #f9fafb; border-color: #d1d5db; }
        .btn-danger { color: var(--danger); border-color: #fecaca; background: #fef2f2; flex: 0.3; }
        .btn-danger:hover { background: #fee2e2; }

        .mode-toggle { position: fixed; bottom: 30px; right: 30px; background: white; padding: 15px 20px; border-radius: 50px; box-shadow: var(--shadow-hover); display: flex; align-items: center; gap: 15px; z-index: 1000; border: 1px solid #e5e7eb;}
        .toggle-switch { position: relative; width: 44px; height: 24px; background: #cbd5e1; border-radius: 24px; cursor: pointer; transition: 0.3s; }
        .toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: 0.3s;}
        .toggle-switch.active { background: var(--primary); }
        .toggle-switch.active::after { left: 22px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; pointer-events: none; transition: 0.3s; padding: 20px; backdrop-filter: blur(5px);}
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: var(--radius-lg); padding: 30px; box-shadow: var(--shadow-hover); transform: translateY(20px); transition: 0.3s; max-height: 90vh; overflow-y: auto;}
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .modal-title { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--text-dark); }
        
        .view-modal-content { max-width: 600px; text-align: center; position: relative; padding: 40px 30px 30px 30px;}
        .view-modal-close { position: absolute; top: 15px; right: 15px; background: #f3f4f6; border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; color: var(--text-gray);}
        .view-modal-close:hover { background: #e5e7eb; color: var(--danger); }
        .view-image { width: 100%; max-height: 400px; object-fit: contain; border-radius: 12px; margin-bottom: 20px; background: #f9fafb; display: none;}
        .view-no-image { width: 100%; height: 300px; background: #f3f4f6; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #9ca3af; margin-bottom: 20px; font-weight: 600;}
        .view-title { font-size: 24px; font-weight: 700; color: var(--text-dark); margin-bottom: 15px; line-height: 1.3;}
        .view-desc { font-size: 16px; color: var(--text-gray); margin-bottom: 15px; text-align: left; line-height: 1.6; background: #f9fafb; padding: 15px; border-radius: 12px;}
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô Modal */
        .view-benefits-box { background: #e0f2fe; padding: 15px; border-radius: 12px; text-align: left; margin-bottom: 25px; border: 1px solid #bae6fd;}
        .view-benefits-title { font-size: 14px; font-weight: 700; color: #0284c7; margin-bottom: 5px; display: flex; align-items: center; gap: 5px;}
        .view-benefits-text { font-size: 15px; color: #0f172a; line-height: 1.5;}

        .view-price-box { background: #fef2f2; padding: 20px; border-radius: 12px; border: 1px dashed #fecaca; display: flex; justify-content: space-between; align-items: center;}

        .form-group { margin-bottom: 15px; text-align: left;}
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text-gray); margin-bottom: 5px; }
        .form-control { width: 100%; padding: 10px 15px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; outline: none; font-family: 'Prompt';}
        .form-control:focus { border-color: var(--primary); }
        
        .modal-actions { display: flex; gap: 10px; margin-top: 25px; }
        .btn-cancel { flex: 1; padding: 12px; border: 1px solid #e5e7eb; background: white; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .btn-save { flex: 1; padding: 12px; border: none; background: var(--success); color: white; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s;}
        .btn-save:hover { background: #059669; }

        .hidden { display: none !important; }
        .loading-text { text-align: center; font-size: 18px; color: var(--text-gray); padding: 40px; grid-column: 1 / -1; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>üì¶ PROMO CENTER</h1>
            <div class="controls">
                <input type="text" id="searchInput" class="search-box" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏ä‡∏∑‡πà‡∏≠, ‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå, ‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏≥‡πÑ‡∏î‡πâ)...">
                <button class="btn-primary hidden" id="btnAddPromo" onclick="openFormModal('add')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</button>
            </div>
        </div>

        <div class="filters" id="filterContainer">
            <button class="filter-btn active" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button class="filter-btn" data-filter="HAPPY TRENDS">HAPPY TRENDS</button>
            <button class="filter-btn" data-filter="YURA">YURA</button>
            <button class="filter-btn" data-filter="BONBACK">BONBACK</button>
            <button class="filter-btn" data-filter="‡∏™‡∏∏‡∏Ç‡∏Å‡∏≤‡∏¢‡∏∞">‡∏™‡∏∏‡∏Ç‡∏Å‡∏≤‡∏¢‡∏∞</button>
            <button class="filter-btn" data-filter="FLi">FLi</button>
            <button class="filter-btn" data-filter="‡πÄ‡∏ö‡∏ç‡∏à ‡∏≠‡∏≠‡∏¢‡∏•‡πå">‡πÄ‡∏ö‡∏ç‡∏à ‡∏≠‡∏≠‡∏¢‡∏•‡πå</button>
            <button class="filter-btn" data-filter="‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÇ‡∏≠‡∏™‡∏ñ">‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÇ‡∏≠‡∏™‡∏ñ</button>
        </div>

        <div class="product-grid" id="productGrid">
            <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î... ‚è≥</div>
        </div>
    </div>

    <div class="mode-toggle">
        <span id="adminLabel" style="font-weight: 600; font-size: 14px; color: var(--text-dark);">‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
        <div class="toggle-switch" id="adminToggle"></div>
    </div>

    <div class="modal-overlay" id="viewModal">
        <div class="modal-content view-modal-content">
            <button class="view-modal-close" onclick="closeViewModal()">‚úñ</button>
            
            <img id="viewImage" class="view-image" src="" alt="Product Image">
            <div id="viewNoImage" class="view-no-image">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
            
            <span class="brand-badge" id="viewBrand" style="margin: 0 auto 15px auto; display: inline-block;"></span>
            <h2 class="view-title" id="viewTitle"></h2>
            
            <div id="viewBenefitsBox" class="view-benefits-box">
                <div class="view-benefits-title">‚ú® ‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì / ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô</div>
                <div id="viewBenefits" class="view-benefits-text"></div>
            </div>

            <div class="view-desc" id="viewDesc"></div>
            
            <div class="view-price-box">
                <div style="text-align: left;">
                    <span style="font-size: 14px; color: var(--danger); font-weight: 600;">üî• ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</span>
                    <span id="viewNormalPrice" style="text-decoration: line-through; color: #9ca3af; font-size: 13px; display: block;"></span>
                </div>
                <div id="viewSpecialPrice" style="font-size: 36px; font-weight: 700; color: var(--danger);"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="formModal">
        <div class="modal-content">
            <h2 class="modal-title" id="formModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
            <input type="hidden" id="formRowIndex">
            
            <div class="form-group">
                <label>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå (Brand)</label>
                <input type="text" id="formBrand" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô YURA, BONBACK">
            </div>
            <div class="form-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡πÄ‡∏ã‡∏ï‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (Title)</label>
                <input type="text" id="formTitle" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ã‡∏ï ‡∏¢‡∏π‡∏£‡πà‡∏≤ 999 ‡∏ö‡∏≤‡∏ó">
            </div>
            
            <div class="form-group">
                <label>‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Benefits)</label>
                <textarea id="formBenefits" class="form-control" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏Ç‡πà‡∏≤ ‡∏™‡∏≤‡∏¢‡∏ï‡∏≤..."></textarea>
            </div>

            <div class="form-group">
                <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏° (Description)</label>
                <textarea id="formDesc" class="form-control" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°‡πÉ‡∏ô‡πÄ‡∏ã‡∏ï..."></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex: 1;">
                    <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà ".-")</label>
                    <input type="text" id="formNormal" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1,957">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà ".-")</label>
                    <input type="text" id="formSpecial" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 999">
                </div>
            </div>
            <div class="form-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (ImageURL)</label>
                <input type="text" id="formImage" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô yura.jpg ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå Drive">
            </div>

            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeFormModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn-save" id="btnSave" onclick="saveData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </div>

    <script>
        // URL ‡∏Ç‡∏≠‡∏á Apps Script
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzfhzBH0dzt1lxObKp6q0Fu6kb3c55UbZaWAI7AuzM712ndg-ExrvMSLv8xiOYxbkq9/exec'; 
        
        const productGrid = document.getElementById('productGrid');
        let allProducts = [];
        let currentAdminLevel = 0; 
        let currentAction = 'add'; 

        function getDirectImageUrl(url) {
            if (!url || url === '‡∏£‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î' || url.trim() === '') return null;
            if (url.includes('drive.google.com')) {
                const match = url.match(/\/d\/(.+?)\//) || url.match(/id=(.+?)(&|$)/);
                if (match && match[1]) return `https://drive.google.com/uc?export=view&id=${match[1]}`;
            }
            return url; 
        }

        async function fetchProducts() {
            productGrid.innerHTML = '<div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î... ‚è≥</div>';
            try {
                const response = await fetch(APPS_SCRIPT_URL);
                allProducts = await response.json();
                renderProducts(allProducts);
            } catch (error) {
                productGrid.innerHTML = '<div class="loading-text" style="color:var(--danger);">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
            }
        }

        function renderProducts(products) {
            productGrid.innerHTML = ''; 
            if(products.length === 0) {
                productGrid.innerHTML = '<div class="loading-text">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>';
                return;
            }

            products.forEach(product => {
                const directImageUrl = getDirectImageUrl(product.ImageURL);
                const imageHtml = directImageUrl 
                    ? `<img src="${directImageUrl}" style="width:100%; height:100%; object-fit:cover;">`
                    : `<span class="img-placeholder">${product.Brand} Image</span>`;

                const normalPriceText = product.NormalPrice ? `‡∏õ‡∏Å‡∏ï‡∏¥ ${product.NormalPrice}.-` : '';
                
                // ‡∏ñ‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
                const benefitTagHtml = product.Benefits 
                    ? `<div class="benefit-tag">‚ú® ${product.Benefits}</div>` 
                    : '';

                const adminClass = currentAdminLevel > 0 ? '' : 'hidden'; 
                const deleteBtnHtml = currentAdminLevel === 2 
                    ? `<button class="btn-action btn-danger" onclick="deleteData(${product._rowIndex}, '${product.Title}')">üóëÔ∏è</button>` 
                    : ''; 

                const cardHtml = `
                    <div class="product-card" data-brand="${product.Brand}">
                        <div class="card-img-wrapper" onclick="openViewModal(${product._rowIndex})">
                            ${imageHtml}
                        </div>
                        <div class="card-content">
                            <span class="brand-badge">${product.Brand}</span>
                            <h2 class="product-title">${product.Title}</h2>
                            ${benefitTagHtml}
                            <p class="product-desc">${product.Description}</p>
                            <div class="price-container">
                                <div>
                                    <span class="normal-price">${normalPriceText}</span>
                                    <span class="special-price">${product.SpecialPrice}.-</span>
                                </div>
                            </div>
                            <div class="admin-controls ${adminClass}">
                                <button class="btn-action" onclick="openFormModal('edit', ${product._rowIndex})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                ${deleteBtnHtml}
                            </div>
                        </div>
                    </div>
                `;
                productGrid.innerHTML += cardHtml;
            });
        }

        fetchProducts();

        // ==========================================
        // ‡∏£‡∏∞‡∏ö‡∏ö View Modal
        // ==========================================
        const viewModal = document.getElementById('viewModal');
        
        function openViewModal(rowIndex) {
            const product = allProducts.find(p => p._rowIndex === rowIndex);
            if(!product) return;

            const viewImage = document.getElementById('viewImage');
            const viewNoImage = document.getElementById('viewNoImage');
            const directImageUrl = getDirectImageUrl(product.ImageURL);

            if (directImageUrl) {
                viewImage.src = directImageUrl;
                viewImage.style.display = 'block';
                viewNoImage.style.display = 'none';
            } else {
                viewImage.style.display = 'none';
                viewNoImage.innerText = `‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (${product.Brand})`;
                viewNoImage.style.display = 'flex';
            }

            document.getElementById('viewBrand').innerText = product.Brand;
            document.getElementById('viewTitle').innerText = product.Title;
            
            // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì
            const benefitsBox = document.getElementById('viewBenefitsBox');
            if(product.Benefits && product.Benefits.trim() !== '') {
                document.getElementById('viewBenefits').innerHTML = product.Benefits.replace(/\n/g, '<br>');
                benefitsBox.style.display = 'block';
            } else {
                benefitsBox.style.display = 'none';
            }

            document.getElementById('viewDesc').innerHTML = product.Description ? `<strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ã‡∏ï:</strong><br>${product.Description.replace(/\n/g, '<br>')}` : '';
            document.getElementById('viewNormalPrice').innerText = product.NormalPrice ? `‡∏õ‡∏Å‡∏ï‡∏¥ ${product.NormalPrice}.-` : '';
            document.getElementById('viewSpecialPrice').innerText = `${product.SpecialPrice}.-`;

            viewModal.classList.add('active');
        }

        function closeViewModal() { viewModal.classList.remove('active'); }
        viewModal.addEventListener('click', (e) => { if(e.target === viewModal) closeViewModal(); });


        // ==========================================
        // ‡∏£‡∏∞‡∏ö‡∏ö Form Modal
        // ==========================================
        const formModal = document.getElementById('formModal');
        const btnSave = document.getElementById('btnSave');

        function openFormModal(action, rowIndex = null) {
            currentAction = action;
            formModal.classList.add('active');

            if (action === 'add') {
                document.getElementById('formModalTitle').innerText = '‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà';
                document.getElementById('formRowIndex').value = '';
                document.getElementById('formBrand').value = '';
                document.getElementById('formTitle').value = '';
                document.getElementById('formBenefits').value = '';
                document.getElementById('formDesc').value = '';
                document.getElementById('formNormal').value = '';
                document.getElementById('formSpecial').value = '';
                document.getElementById('formImage').value = '';
            } else if (action === 'edit') {
                document.getElementById('formModalTitle').innerText = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô';
                const product = allProducts.find(p => p._rowIndex === rowIndex);
                if(product) {
                    document.getElementById('formRowIndex').value = product._rowIndex;
                    document.getElementById('formBrand').value = product.Brand;
                    document.getElementById('formTitle').value = product.Title;
                    document.getElementById('formBenefits').value = product.Benefits || '';
                    document.getElementById('formDesc').value = product.Description;
                    document.getElementById('formNormal').value = product.NormalPrice;
                    document.getElementById('formSpecial').value = product.SpecialPrice;
                    document.getElementById('formImage').value = product.ImageURL;
                }
            }
        }

        function closeFormModal() { formModal.classList.remove('active'); }

        async function saveData() {
            const payload = {
                action: currentAction,
                data: {
                    _rowIndex: document.getElementById('formRowIndex').value,
                    Brand: document.getElementById('formBrand').value,
                    Title: document.getElementById('formTitle').value,
                    Benefits: document.getElementById('formBenefits').value,
                    Description: document.getElementById('formDesc').value,
                    NormalPrice: document.getElementById('formNormal').value,
                    SpecialPrice: document.getElementById('formSpecial').value,
                    ImageURL: document.getElementById('formImage').value
                }
            };

            if(!payload.data.Brand || !payload.data.Title) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå ‡πÅ‡∏•‡∏∞ ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
                return;
            }

            btnSave.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å... ‚è≥';
            btnSave.style.pointerEvents = 'none';

            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });
                closeFormModal();
                alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
                fetchProducts(); 
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            } finally {
                btnSave.innerText = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                btnSave.style.pointerEvents = 'auto';
            }
        }

        async function deleteData(rowIndex, title) {
            if(confirm(`‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${title}" ?`)) {
                try {
                    await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify({ action: 'delete', data: { _rowIndex: rowIndex } })
                    });
                    fetchProducts();
                } catch (error) { alert('‚ùå ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }
            }
        }

        // ==========================================
        // ‡∏£‡∏∞‡∏ö‡∏ö Login ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Admin
        // ==========================================
        const adminToggle = document.getElementById('adminToggle');
        const adminLabel = document.getElementById('adminLabel');
        const btnAddPromo = document.getElementById('btnAddPromo');

        adminToggle.addEventListener('click', () => {
            if (currentAdminLevel === 0) {
                const password = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î Admin:');
                if (password === 'admin9sing') {
                    currentAdminLevel = 2;
                    adminToggle.classList.add('active');
                    adminLabel.innerText = 'üëë Super Admin';
                    adminLabel.style.color = '#4f46e5';
                    btnAddPromo.classList.remove('hidden');
                    renderProducts(allProducts); 
                } else if (password === 'admin0208') {
                    currentAdminLevel = 1;
                    adminToggle.classList.add('active');
                    adminLabel.innerText = 'üë§ Admin ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤';
                    adminLabel.style.color = '#059669';
                    btnAddPromo.classList.remove('hidden');
                    renderProducts(allProducts); 
                } else if (password !== null) {
                    alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }
            } else {
                currentAdminLevel = 0;
                adminToggle.classList.remove('active');
                adminLabel.innerText = '‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô';
                adminLabel.style.color = 'var(--text-dark)';
                btnAddPromo.classList.add('hidden');
                renderProducts(allProducts); 
            }
        });

        // ==========================================
        // ‡∏£‡∏∞‡∏ö‡∏ö Smart Search (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ)
        // ==========================================
        document.getElementById('searchInput').addEventListener('keyup', (e) => {
            const searchText = e.target.value.toLowerCase().trim();
            if(!searchText) {
                renderProducts(allProducts);
                return;
            }

            // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ‡πÄ‡∏ä‡πà‡∏ô "‡∏á‡∏≤‡∏î‡∏≥ ‡πÄ‡∏Ç‡πà‡∏≤" -> ["‡∏á‡∏≤‡∏î‡∏≥", "‡πÄ‡∏Ç‡πà‡∏≤"]
            const searchTerms = searchText.split(/\s+/);

            const filtered = allProducts.filter(p => {
                // ‡πÄ‡∏≠‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô
                const combinedText = `
                    ${p.Brand || ''} 
                    ${p.Title || ''} 
                    ${p.Description || ''} 
                    ${p.Benefits || ''}
                `.toLowerCase();
                
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏à‡∏≠ "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥" ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤
                return searchTerms.every(term => combinedText.includes(term));
            });
            
            renderProducts(filtered);
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-filter="all"]').classList.add('active');
        });

        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('searchInput').value = '';
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const filterValue = btn.getAttribute('data-filter').toLowerCase().trim();
                if(filterValue === 'all') renderProducts(allProducts);
                else {
                    const filtered = allProducts.filter(p => {
                        const brandName = p.Brand ? p.Brand.toString().toLowerCase().trim() : '';
                        return brandName === filterValue;
                    });
                    renderProducts(filtered);
                }
            });
        });
    </script>
</body>
</html>
